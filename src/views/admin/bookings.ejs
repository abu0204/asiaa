<%- include("../layouts/adminheaders") %>

<div class="admin-layout">
  <%- include("../layouts/sidebar") %>

  <main class="bookingcontent-area">
    <div class="container-fluid mt-4">
      <h3 class="mb-4">Trip Bookings</h3>

      <div class="booking-cards" id="tripCards">
        <% if (data.length === 0) { %>
          <p class="text-center">No trips found</p>
        <% } %>

        <% data.forEach((trip, index) => { %>
          <div class="booking-card">

            <div class="booking-card-header">
              <span>#<%= index + 1 %></span>
              <span class="badge bg-secondary"><%= trip.status %></span>
            </div>

            <div class="booking-info">
              <p><strong>Name:</strong> <%= trip.name %></p>
              <p><strong>Mobile:</strong> <%= trip.mobile %></p>
              <p><strong>Pickup:</strong> <%= trip.pickup %></p>
              <p><strong>Drop:</strong> <%= trip.drop %></p>
              <p><strong>Travel Type:</strong> <%= trip.travelType %></p>
              <p><strong>Vehicle:</strong> <%= trip.vehicleType %></p>
              <p><strong>Total Fare:</strong> ₹ <%= trip.totalVal %></p>
              <p><strong>Date:</strong>
                <%= new Date(trip.createdAt).toLocaleDateString("en-IN") %>
              </p>
            </div>

            <div class="booking-actions">
              <button
                class="btn btn-sm btn-info"
                onclick="viewTrip('<%= trip._id %>')">
                View
              </button>

              <button
                class="btn btn-sm btn-success"
                onclick="approveTrip('<%= trip._id %>')"
                <%= trip.status === "Approve" ? "disabled" : "" %>>
                <%= trip.status === "Approve" ? "Approved" : "Approve" %>
              </button>
            </div>

          </div>
        <% }) %>
      </div>
    </div>
  </main>
</div>

<!-- Modal stays SAME -->
<%- include("../layouts/adminfooter") %>
<script>
  socket.on("userBooked", (trip) => {
    pushNewTrip(trip);
  });

  function pushNewTrip(trip) {
    const container = document.getElementById("tripCards");

    const card = document.createElement("div");
    card.className = "booking-card";

    card.innerHTML = `
      <div class="booking-card-header">
        <span>#</span>
        <span class="badge bg-secondary">${trip.status}</span>
      </div>

      <div class="booking-info">
        <p><strong>Name:</strong> ${trip.name}</p>
        <p><strong>Mobile:</strong> ${trip.mobile}</p>
        <p><strong>Pickup:</strong> ${trip.pickup}</p>
        <p><strong>Drop:</strong> ${trip.drop}</p>
        <p><strong>Travel Type:</strong> ${trip.travelType}</p>
        <p><strong>Vehicle:</strong> ${trip.vehicleType}</p>
        <p><strong>Total Fare:</strong> ₹ ${trip.totalVal}</p>
        <p><strong>Date:</strong>
          ${new Date(trip.createdAt).toLocaleDateString("en-IN")}
        </p>
      </div>

      <div class="booking-actions">
        <button class="btn btn-sm btn-info"
          onclick="viewTrip('${trip._id}')">
          View
        </button>

        <button class="btn btn-sm btn-success"
          onclick="approveTrip('${trip._id}')"
          ${trip.status === "Approve" ? "disabled" : ""}>
          ${trip.status === "Approve" ? "Approved" : "Approve"}
        </button>
      </div>
    `;

    container.prepend(card);
  }
</script>
